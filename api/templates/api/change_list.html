{#{% extends "admin/base_site.html" %}#}
{#{% load i18n admin_urls static admin_list %}#}
{##}
{#{% block extrastyle %}#}
{#  {{ block.super }}#}
{#  <link rel="stylesheet" type="text/css" href="{% static "admin/css/changelists.css" %}">#}
{#  {% if cl.formset %}#}
{#    <link rel="stylesheet" type="text/css" href="{% static "admin/css/forms.css" %}">#}
{#  {% endif %}#}
{#  {% if cl.formset or action_form %}#}
{#    <script type="text/javascript" src="{% url 'admin:jsi18n' %}"></script>#}
{#  {% endif %}#}
{#  {{ media.css }}#}
{#  {% if not actions_on_top and not actions_on_bottom %}#}
{#    <style>#}
{#      #changelist table thead th:first-child {width: inherit}#}
{#    </style>#}
{#  {% endif %}#}
{#{% endblock %}#}
{##}
{#{% block extrahead %}#}
{#{{ block.super }}#}
{#{{ media.js }}#}
{#{% endblock %}#}
{##}
{#{% block bodyclass %}{{ block.super }} app-{{ opts.app_label }} model-{{ opts.model_name }} change-list{% endblock %}#}
{##}
{#{% if not is_popup %}#}
{#{% block breadcrumbs %}#}
{#<div class="breadcrumbs">#}
{#<a href="{% url 'admin:index' %}">{% trans 'Home' %}</a>#}
{#&rsaquo; <a href="{% url 'admin:app_list' app_label=cl.opts.app_label %}">{{ cl.opts.app_config.verbose_name }}</a>#}
{#&rsaquo; {{ cl.opts.verbose_name_plural|capfirst }}#}
{#</div>#}
{#{% endblock %}#}
{#{% endif %}#}
{##}
{#{% block coltype %}flex{% endblock %}#}
{##}
{#{% block content %}#}
{#  <div id="content-main">#}
{#    {% block object-tools %}#}
{#        <ul class="object-tools">#}
{#          {% block object-tools-items %}#}
{#            {% change_list_object_tools %}#}
{#                <li>#}
{#                        <a class="scrapelink" href="{% url 'admin:scrape' %}">Scrape Petrol Price</a>#}
{#                </li>#}
{#          {% endblock %}#}
{#        </ul>#}
{#    {% endblock %}#}
{#    {% if cl.formset and cl.formset.errors %}#}
{#        <p class="errornote">#}
{#        {% if cl.formset.total_error_count == 1 %}{% trans "Please correct the error below." %}{% else %}{% trans "Please correct the errors below." %}{% endif %}#}
{#        </p>#}
{#        {{ cl.formset.non_form_errors }}#}
{#    {% endif %}#}
{#    <div class="module{% if cl.has_filters %} filtered{% endif %}" id="changelist">#}
{#      {% block search %}{% search_form cl %}{% endblock %}#}
{#      {% block date_hierarchy %}{% if cl.date_hierarchy %}{% date_hierarchy cl %}{% endif %}{% endblock %}#}
{##}
{#      {% block filters %}#}
{#        {% if cl.has_filters %}#}
{#          <div id="changelist-filter">#}
{#            <h2>{% trans 'Filter' %}</h2>#}
{#            {% for spec in cl.filter_specs %}{% admin_list_filter cl spec %}{% endfor %}#}
{#          </div>#}
{#        {% endif %}#}
{#      {% endblock %}#}
{##}
{#      <form id="changelist-form" method="post"{% if cl.formset and cl.formset.is_multipart %} enctype="multipart/form-data"{% endif %} novalidate>{% csrf_token %}#}
{#      {% if cl.formset %}#}
{#        <div>{{ cl.formset.management_form }}</div>#}
{#      {% endif %}#}
{##}
{#      {% block result_list %}#}
{#          {% if action_form and actions_on_top and cl.show_admin_actions %}{% admin_actions %}{% endif %}#}
{#          {% result_list cl %}#}
{#          {% if action_form and actions_on_bottom and cl.show_admin_actions %}{% admin_actions %}{% endif %}#}
{#      {% endblock %}#}
{#      {% block pagination %}{% pagination cl %}{% endblock %}#}
{#      </form>#}
{#    </div>#}
{#  </div>#}
{#{% endblock %}#}



{% extends 'admin/change_list.html' %}
{% load static %}
{% block content %}

<b>CLICK ON THE SCRAPE BUTTON TO SCRAPE DATA OF A PARTICULAR STATE</b>
    <h5><b style="color: red">note:</b> scrapping data may take some time, please wait !</h5>

    <table id="state_list">
{#  <tr>#}
{#    <th>ID</th>#}
{#    <th>STATE</th>#}
{#    <th>UPDATE</th>#}
{#  </tr>#}
{#  <tr>#}
{#    <td>0</td>#}
{#    <td>Andaman and Nicobar</td>#}
{#    <td> <input type="submit" value="Submit" onclick="callScrapper(0)"></td>#}
{#  </tr>#}
{#   <tr>#}
{#    <td>1</td>#}
{#    <td>Andhra Pradesh</td>#}
{#    <td> <input type="submit" value="Submit" onclick="callScrapper(1)"></td>#}
{#  </tr>#}
{#   <tr>#}
{#    <td>2</td>#}
{#    <td>Arunachal Pradesh</td>#}
{#    <td> <input type="submit" value="Submit" onclick="callScrapper(2)"></td>#}
{#  </tr>#}
{#   <tr>#}
{#    <td>3</td>#}
{#    <td>Assam</td>#}
{#    <td> <input type="submit" value="Submit" onclick="callScrapper(3)"></td>#}
{#  </tr>#}
{#  <tr>#}
{#    <td>4</td>#}
{#    <td>Bihar</td>#}
{#    <td> <input type="submit" value="Submit" onclick="callScrapper(4)"></td>#}
{#  </tr>#}
{# <tr>#}
{#    <td>5</td>#}
{#    <td>Chandigarh</td>#}
{#    <td> <input type="submit" value="Submit" onclick="callScrapper(5)"></td>#}
{#  </tr>#}
{#    <tr>#}
{#    <td>6</td>#}
{#    <td>Chhatisgarh</td>#}
{#    <td> <input type="submit" value="Submit" onclick="callScrapper(6)"></td>#}
{#  </tr>#}
{#    <tr>#}
{#    <td>7</td>#}
{#    <td>Dadra Nagarhaveli</td>#}
{#    <td> <input type="submit" value="Submit" onclick="callScrapper(7)"></td>#}
{#  </tr>#}
{#    <tr>#}
{#    <td>8</td>#}
{#    <td>Daman and Diu</td>#}
{#    <td> <input type="submit" value="Submit" onclick="callScrapper(8)"></td>#}
{#  </tr>#}
{#    <tr>#}
{#    <td>9</td>#}
{#    <td>Delhi</td>#}
{#    <td> <input type="submit" value="Submit" onclick="callScrapper(9)"></td>#}
{#  </tr>#}
{#    <tr>#}
{#    <td>10</td>#}
{#    <td>Goa</td>#}
{#    <td> <input type="submit" value="Submit" onclick="callScrapper(10)"></td>#}
{#  </tr>#}
{#    <tr>#}
{#    <td>11</td>#}
{#    <td>Gujarat</td>#}
{#    <td> <input type="submit" value="Submit" onclick="callScrapper(11)"></td>#}
{#  </tr>#}
{#    <tr>#}
{#    <td>12</td>#}
{#    <td>Haryana</td>#}
{#    <td> <input type="submit" value="Submit" onclick="callScrapper(12)"></td>#}
{#  </tr>#}
{#    <tr>#}
{#    <td>13</td>#}
{#    <td>Himachal Pradesh</td>#}
{#    <td> <input type="submit" value="Submit" onclick="callScrapper(13)"></td>#}
{#  </tr>#}
{#    <tr>#}
{#    <td>14</td>#}
{#    <td>Jammu and Kashmir</td>#}
{#    <td> <input type="submit" value="Submit" onclick="callScrapper(14)"></td>#}
{#        <td style="height: 2px; width: 2px;"><img src="{% static "icons/tick.png" %}" alt="Tick"/></td>#}
{#  </tr>#}
</table>

</div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <script>

    var x="";
    var states = ["Andaman and Nicobar Islands","Andhra Pradesh","Arunachal Pradesh ","Assam","Bihar", "Chandigarh", "Chhattisgarh", "Dadra and Nagar Haveli", "Daman and Diu", "Delhi", "Goa","Gujarat","Haryana","Himachal Pradesh","Jammu and Kashmir","Jharkhand","Karnataka","Kerala","Madhya Pradesh","Maharashtra","Manipur","Meghalaya","Mizoram","Nagaland","Odisha" ,"Puducherry","Punjab","Rajasthan","Sikkim","Tamil Nadu","Telangana","Tripura","Uttar Pradesh","Uttarakhand","West Bengal"];
    states.forEach(setTable);
    document.getElementById("state_list").innerHTML = x;

    function setTable(value, index, array) {

        x = x + " </tr>\n" +
            "    <tr>\n" +
            "    <td>"+index+"</td>\n" +
            "    <td>"+value+"</td>\n" +
            "    <td> <input id="+index+" class=\"not_done\" type=\"submit\" value=\"Scrape Petrol\" onclick=\"callScrapper("+index+","+1+")\"></td>\n" +
            "        <td style=\"height: 2px; width: 2px;\"><img id=id"+index+" src=\"{% static "icons/cross_30.png" %}\" alt=\"Tick\"/></td>\n" +
            "    <td> <input id="+"diesel"+index+" class=\"dieselnot_done\" type=\"submit\" value=\"Scrape Diesel\" onclick=\"callScrapper("+index+","+2+")\"></td>\n" +
            "        <td style=\"height: 2px; width: 2px;\"><img id=id"+"diesel"+index+" src=\"{% static "icons/cross_30.png" %}\" alt=\"Tick\"/></td>\n" +
            "  </tr>"
    }


    function callScrapper(id, fuel){
        console.log(fuel);

        if(fuel===1){
            fuel_code=1;
            tag = "";
        }
        else{
            fuel_code=2;
            tag = "diesel";
        }

        document.getElementById("id"+tag+id).src = '{% static "icons/loading_updated.gif" %}';
        b = document.getElementsByClassName("not_done");
        x = document.getElementsByClassName("dieselnot_done");
        for (i = 0; i < b.length; i++){

            b[i].disabled = true;
        }

        for (j = 0; j < x.length; j++){
                             x[j].disabled = true;
                        }

        console.log(id);
        document.getElementById(tag+id).disabled = true;
        {#setTimeout(function(){ document.getElementById(id).disabled = false;}, 3000);#}

        url = 'https://gaurav-api-practice.herokuapp.com/call-scrapper/'+id+'/';
        {#url = 'http://127.0.0.1:8080/call-scrapper/'+id+'/';#}
        {#window.location = url#}



        console.log("before ajax");
        $.ajax({url: url,
                data: { "fuel_code": fuel_code},
            success: function(result){
                console.log(result.result);
                document.getElementById("id"+tag+id).src = '{% static "icons/tick_30.png" %}';
                document.getElementById(tag+id).className = "done";
                c = document.getElementsByClassName("not_done");
                y = document.getElementsByClassName("dieselnot_done");
                for (i = 0; i < c.length; i++){
                             c[i].disabled = false;
                        }

                for (j = 0; j < y.length; j++){
                             y[j].disabled = false;
                        }

            }});


    }
    </script>

{{ block.super }}

{% endblock %}